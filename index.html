<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Couvert</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
    h2 { margin-top: 30px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, button {
      width: 100%; padding: 8px; margin-top: 4px; border: 1px solid #ccc;
      border-radius: 4px; font-size: 14px;
    }
    input[readonly] { background: #eee; }
    button { background: #2c3e50; color: #fff; cursor: pointer; }
    button:hover { background: #34495e; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; background: white; }
    th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
    .pago { background: #c8f7c5; }
    .pendente { background: #f7c5c5; }
  </style>
</head>
<body>
  <h1>Painel Couvert</h1>

  <form id="form">
    <label>Mês</label>
    <input type="text" name="mes" required placeholder="Agosto de 2025">
    
    <label>Data</label>
    <input type="date" name="data" required>

    <label>Profissional</label>
    <input list="listaProfissionais" name="profissional" id="profissional" required>
    <datalist id="listaProfissionais"></datalist>

    <label>Função</label>
    <input type="text" name="funcao" id="funcao">

    <label>Dados bancários / Pix</label>
    <input type="text" name="dadosPix" id="dadosPix">

    <label>Tempo</label>
    <input type="text" name="tempo">

    <label>Valor acordado (R$)</label>
    <input type="number" name="valorAcordado" id="valorAcordado">

    <label>Bonificação (R$)</label>
    <input type="number" name="bonificacao" id="bonificacao">

    <label>Desconto de consumo (R$)</label>
    <input type="number" name="desconto" id="desconto">

    <label>Valor final (R$)</label>
    <input type="number" name="valorFinal" id="valorFinal" readonly>

    <label>Data Pagamento</label>
    <input type="date" name="dataPagamento">

    <label>Status</label>
    <select name="status">
      <option value="PENDENTE">PENDENTE</option>
      <option value="PAGO">PAGO</option>
    </select>

    <button type="submit">Salvar</button>
  </form>

  <h2>Lançamentos</h2>
  <table id="tabela">
    <thead>
      <tr><th>Profissional</th><th>Data</th><th>Valor Final</th><th>Status</th><th>Ações</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const URL = 'https://script.google.com/macros/s/AKfycbxcQy_eF_kNRKU_xu0vVeFqP5PY8ukBO0YsFNpSE-duCUCRgBexBr0SD9bpTaC_N0ogjg/exec';

    const form = document.getElementById('form');
    const profissionalInput = document.getElementById('profissional');
    const funcaoInput = document.getElementById('funcao');
    const dadosPixInput = document.getElementById('dadosPix');
    const valorAcordadoInput = document.getElementById('valorAcordado');
    const bonificacaoInput = document.getElementById('bonificacao');
    const descontoInput = document.getElementById('desconto');
    const valorFinalInput = document.getElementById('valorFinal');

    let profissionais = [];

    // === Carregar profissionais ===
    fetch(`${URL}?acao=profissionais`)
      .then(res => res.json())
      .then(data => {
        profissionais = data;
        const lista = document.getElementById('listaProfissionais');
        lista.innerHTML = '';
        data.forEach(p => {
          const opt = document.createElement('option');
          opt.value = p.nome;
          lista.appendChild(opt);
        });
      });

    profissionalInput.addEventListener('input', () => {
      const p = profissionais.find(p => p.nome === profissionalInput.value);
      if (p) {
        funcaoInput.value = p.funcao || '';
        dadosPixInput.value = p.pix || '';
        valorAcordadoInput.value = p.valor || '';
      }
    });

    // === Cálculo automático ===
    [valorAcordadoInput, bonificacaoInput, descontoInput].forEach(input => {
      input.addEventListener('input', () => {
        const v = parseFloat(valorAcordadoInput.value) || 0;
        const b = parseFloat(bonificacaoInput.value) || 0;
        const d = parseFloat(descontoInput.value) || 0;
        valorFinalInput.value = (v - b - d).toFixed(2);
      });
    });

    // === Submeter formulário ===
    form.addEventListener('submit', e => {
      e.preventDefault();
      const dados = Object.fromEntries(new FormData(form));
      dados.acao = 'adicionar';
      fetch(URL, {
        method: 'POST',
        body: JSON.stringify(dados)
      }).then(res => res.text())
        .then(() => {
          alert('Salvo com sucesso!');
          form.reset();
          carregarLancamentos();
        });
    });

    // === Carregar lançamentos ===
    function carregarLancamentos() {
      fetch(`${URL}?acao=ler`)
        .then(res => res.json())
        .then(data => {
          const tbody = document.querySelector('#tabela tbody');
          tbody.innerHTML = '';
          data.forEach((item, i) => {
            const tr = document.createElement('tr');
            tr.className = item.status === 'PAGO' ? 'pago' : 'pendente';
            tr.innerHTML = `
              <td>${item.profissional}</td>
              <td>${item.data}</td>
              <td>R$ ${item.valorFinal.toFixed(2)}</td>
              <td>${item.status}</td>
              <td>
                <button onclick="alterarStatus(${item.index})">Status</button>
                <button onclick="excluir(${item.index})">Excluir</button>
              </td>`;
            tbody.appendChild(tr);
          });
        });
    }

    function alterarStatus(index) {
      fetch(URL, {
        method: 'POST',
        body: JSON.stringify({ acao: 'status', index })
      }).then(() => carregarLancamentos());
    }

    function excluir(index) {
      const senha = prompt("Digite a senha para excluir:");
      if (senha === '1234') {
        fetch(URL, {
          method: 'POST',
          body: JSON.stringify({ acao: 'excluir', index })
        }).then(() => carregarLancamentos());
      } else {
        alert("Senha incorreta.");
      }
    }

    carregarLancamentos();
  </script>
</body>
</html>
