<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel Couvert</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    .logo-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #000;
    }
    .logo-container img {
      width: 200px;
      animation: fadeIn 1.5s ease-in-out;
    }
    .loader {
      margin-top: 20px;
      display: flex;
      gap: 8px;
    }
    .loader span {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: #00ffff;
      animation: pulse 1s infinite alternate;
    }
    .loader span:nth-child(2) { animation-delay: 0.2s; }
    .loader span:nth-child(3) { animation-delay: 0.4s; }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes pulse {
      from { transform: scale(1); opacity: 0.4; }
      to { transform: scale(1.5); opacity: 1; }
    }

    .painel {
      max-width: 700px;
      margin: 40px auto;
      padding: 30px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: none;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
      color: #333;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
      color: #222;
    }
    input, select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 15px;
    }
    input[readonly] {
      background: #eee;
    }
    .aviso {
      color: red;
      font-size: 13px;
      margin-top: 4px;
    }
    .botoes {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }
    .botoes button {
      background-color: #008080;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    .botoes button:hover {
      background-color: #006666;
    }
  </style>
</head>
<body>
  <div class="logo-container" id="splash">
    <img src="https://static.wixstatic.com/media/d830b0_8cec50a98bbf4775814dbfa5386585e8~mv2.png" alt="Logo Grupo DV">
    <div class="loader">
      <span></span><span></span><span></span>
    </div>
  </div>

  <div class="painel" id="painel">
    <h2>Painel Couvert</h2>

    <label>Mês</label>
    <input type="text" id="mes">

    <label>Data</label>
    <input type="date" id="data">

    <label>Profissional</label>
    <input list="lista-profissionais" id="profissional">
    <datalist id="lista-profissionais"></datalist>

    <label>Função</label>
    <input type="text" id="funcao">

    <label>Dados bancários / Pix</label>
    <input type="text" id="dadosPix">
    <div id="avisoPix" class="aviso" style="display:none">⚠️ Atenção: confira se o PIX está correto!</div>

    <label>Tempo</label>
    <input type="text" id="tempo">

    <label>Valor acordado</label>
    <input type="number" id="valorAcordado" step="0.01">

    <label>Bonificação</label>
    <input type="number" id="bonificacao" step="0.01">

    <label>Desconto de Consumo</label>
    <input type="number" id="desconto" step="0.01">

    <label>Valor (automático)</label>
    <input type="text" id="valorFinal" readonly>

    <label>Data de Pagamento</label>
    <input type="date" id="dataPagamento">

    <div class="botoes">
      <button onclick="salvarLancamento()">Cadastrar</button>
    </div>
  </div>

  <script>
    window.onload = () => {
      setTimeout(() => {
        document.getElementById('splash').style.display = 'none';
        document.getElementById('painel').style.display = 'block';
        preencherData();
        carregarProfissionais();
      }, 1500);
    }

    function preencherData() {
      const hoje = new Date();
      const mes = hoje.toLocaleString('pt-BR', { month: 'long' });
      const ano = hoje.getFullYear();
      document.getElementById('mes').value = `${mes} de ${ano}`;
      document.getElementById('data').valueAsDate = hoje;
    }

    async function carregarProfissionais() {
      const resp = await fetch("SEU_SCRIPT_URL?acao=profissionais");
      const lista = await resp.json();
      const datalist = document.getElementById("lista-profissionais");
      datalist.innerHTML = "";
      lista.forEach(p => {
        const opt = document.createElement("option");
        opt.value = p.nome;
        opt.dataset.funcao = p.funcao;
        opt.dataset.pix = p.pix;
        opt.dataset.valor = p.valor;
        datalist.appendChild(opt);
      });

      document.getElementById("profissional").addEventListener("change", e => {
        const opt = [...datalist.options].find(o => o.value === e.target.value);
        if (opt) {
          document.getElementById("funcao").value = opt.dataset.funcao;
          document.getElementById("dadosPix").value = opt.dataset.pix;
          document.getElementById("valorAcordado").value = parseFloat(opt.dataset.valor || 0);
          document.getElementById("avisoPix").style.display = 'block';
          calcularValor();
        } else {
          document.getElementById("avisoPix").style.display = 'none';
        }
      });
    }

    const inputsValor = ["valorAcordado", "bonificacao", "desconto"];
    inputsValor.forEach(id => {
      document.getElementById(id).addEventListener("input", calcularValor);
    });

    function calcularValor() {
      const valor =
        parseFloat(document.getElementById("valorAcordado").value || 0) +
        parseFloat(document.getElementById("bonificacao").value || 0) -
        parseFloat(document.getElementById("desconto").value || 0);
      document.getElementById("valorFinal").value = valor.toLocaleString("pt-BR", {
        style: "currency",
        currency: "BRL"
      });
    }

    function salvarLancamento() {
      const dados = {
        acao: 'adicionar',
        mes: document.getElementById('mes').value,
        data: document.getElementById('data').value,
        profissional: document.getElementById('profissional').value,
        funcao: document.getElementById('funcao').value,
        dadosPix: document.getElementById('dadosPix').value,
        tempo: document.getElementById('tempo').value,
        valorAcordado: parseFloat(document.getElementById('valorAcordado').value || 0),
        bonificacao: parseFloat(document.getElementById('bonificacao').value || 0),
        desconto: parseFloat(document.getElementById('desconto').value || 0),
        valorFinal: document.getElementById('valorFinal').value.replace(/[R$\s.]/g, '').replace(',', '.'),
        dataPagamento: document.getElementById('dataPagamento').value,
        status: 'PENDENTE'
      };

      const loader = document.createElement('div');
      loader.className = 'logo-container';
      loader.innerHTML = `
        <img src="https://static.wixstatic.com/media/d830b0_8cec50a98bbf4775814dbfa5386585e8~mv2.png" alt="Logo Grupo DV">
        <div class="loader">
          <span></span><span></span><span></span>
        </div>`;
      document.body.innerHTML = '';
      document.body.appendChild(loader);

      fetch("SEU_SCRIPT_URL", {
        method: 'POST',
        body: JSON.stringify(dados),
        headers: { 'Content-Type': 'application/json' }
      }).then(r => r.text()).then(retorno => {
        location.reload();
      });
    }
  </script>
</body>
</html>
